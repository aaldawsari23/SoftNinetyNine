# خطة تنفيذية متدرجة لتطوير متجر Soft99bike (بدون الاعتماد على باك-إند حالياً)

## 1) أهداف الخطة
- تجهيز الواجهة الحالية لتصبح جاهزة للربط بقاعدة بيانات أو تخزين خارجي لاحقاً بدون إعادة كتابة كبيرة.
- تحسين جودة الكود وتجربة المستخدم الآن بالاعتماد على المصادر المحلية (JSON/صور) فقط.
- تقليل الكلفة وتعقيد البنية قدر الإمكان مع إبقاء الباب مفتوحاً للتوسع (Auth حقيقي، قواعد بيانات، دفع).

## 2) مبادئ أساسية قبل البدء
- **لا خدمات خارجية حالياً**: كل العمل داخل الكود؛ نحضّر الواجهات وطبقة البيانات بحيث يمكن تبديل المصدر لاحقاً.
- **توحيد الموديلات والأنواع**: اعتماد واجهات TypeScript مركزية لـ Product/Category/Brand/User/Order.
- **قابلية الاستبدال**: بناء طبقة `data providers` قابلة للتبديل بين JSON محلي ومستقبل API دون لمس المكونات.
- **حراسة بسيطة مؤقتة**: الإبقاء على حراسة لوحة التحكم الحالية لكن إعادة هيكلتها لتسهيل ربط Auth لاحقاً.
- **قابلية الاختبار**: إضافة اختبارات وحدات/واجهة بسيطة لأهم المسارات لضمان عدم كسر السلوك أثناء التحسين.

## 3) المرحلة 0: تجهيز الأساس والتنظيف
1. **تنظيم المجلدات والتسميات**
   - توحيد المسارات التي تُستخدم حالياً كمرجع بيانات: `public/data/products.json`، الصور في `public/Images/`.
   - إنشاء مجلد `src/lib/data-providers/` يضم مزود البيانات المحلي (`localProvider.ts`) ومزوداً وهمياً للـ API (`apiProvider.stub.ts`).
   - نقل/تحديث أنواع البيانات إلى `src/types/index.ts` أو ملفات منفصلة (Product, Category, Brand, User, Order) مع حقول مستقبلية (مثل `remoteImageUrl`, `status`, `stockQuantity`).
2. **نظافة الكود والمكونات**
   - مراجعة المكونات العامة في `src/components/` لضمان عدم تكرار المنطق (استخدام Hooks مشتركة للفلاتر/السعر/الترتيب).
   - إزالة أي استخدام مباشر للـ JSON داخل المكونات واستبداله بوارد من المزود الجديد (حتى لو كان مصدره نفس الـ JSON حالياً).
3. **تحسين مسارات Next.js**
   - التأكد من ضبط `metadata` و`viewport` في `src/app/layout.tsx` وربط خطوط/أيقونات متوافقة RTL.
   - تفعيل `dynamic = 'force-static'` حيث يناسب الصفحات الثابتة لضمان بناء سريع وكاش أقوى.

## 4) المرحلة 1: تحسين تجربة المتجر (محلي بالكامل)
1. **طبقة البيانات**
   - تنفيذ `localProvider.ts` الذي يقرأ من `public/data/products.json` ويُرجع بيانات مطابقة للأنواع.
   - إضافة كاش خفيف داخل الذاكرة أو عبر `App Router fetchCache` لتقليل القراءة المتكررة.
   - توحيد منطق الفلاتر والفرز في `src/utils/catalog.ts` (جديد) ليُستخدم من صفحات `src/app/products/page.tsx` ومكون `CatalogContent`.
2. **تجربة المستخدم**
   - تحديث بطاقات المنتجات لعرض حالة المخزون المؤقتة (من JSON) وشارة `isFeatured`.
   - تحسين تنبيهات أخطاء التحميل/عدم وجود نتائج باستخدام مكونات Alert في `src/components/common` (إن وجدت أو تُنشأ).
   - تحسين دعم اللغة والاتجاه عبر فحص `dir` في `layout` وضبط Tailwind RTL بشكل صريح.
3. **التصميم والأداء**
   - استخدام `next/image` مع loader محلي وضبط أحجام الصور في البطاقات والقوائم لتقليل CLS.
   - إضافة `skeleton loaders` للبطاقات والقوائم أثناء القراءة من المزود المحلي (تحاكي الانتقال مستقبلاً لـ API).

## 5) المرحلة 2: لوحة التحكم وإدارة الحالة (بدون باك-إند حقيقي)
1. **حراسة المسارات**
   - نقل منطق تسجيل الدخول الحالي إلى Hook موحّد `useAdminAuth` في `src/contexts` مع واجهة مستقبلية لـ Supabase Auth.
   - إضافة Middleware خفيف في `src/middleware.ts` يوجّه غير المصرح لهم من `/admin` إلى `/admin/login` (يستخدم التخزين المحلي فقط مؤقتاً).
2. **CRUD محلي قابل للاستبدال**
   - إنشاء `adminLocalStore.ts` ضمن `src/lib/data-providers/` لإدارة المنتجات/الفئات/الماركات محلياً (باستخدام Zustand أو ملف JSON يُكتب أثناء التطوير فقط).
   - توحيد نماذج الإدخال في لوحة التحكم لتستخدم نفس الأنواع وتتحقق من الحقول (price/sku/stock) قبل الحفظ.
   - إضافة واجهة وهمية لرفع الصور تحفظ في `public/Images/` أثناء التطوير، مع توقيع دالة متوافق مع رفع S3/Supabase لاحقاً.
3. **اختبارات وضمان الجودة**
   - إضافة اختبارات وحدات لطبقة المزود (localProvider, catalog utils) باستخدام Jest/Vitest.
   - اختبار المكونات الحرجة (بطاقة المنتج، نموذج إنشاء المنتج) باستخدام Testing Library لضمان بقاء السلوك بعد ربط الباك-إند.

## 6) المرحلة 3: جاهزية ربط باك-إند مستقبلي (تحضير دون تفعيل)
1. **تجهيز الـ API Client بدون تفعيل**
   - إنشاء ملف `src/lib/apiClient.ts` يحوي دوال جاهزة للاتصال (placeholders) مع قراءة مفاتيح من `process.env`؛ يبقى غير مستخدم في الإنتاج إلى حين تفعيل الخدمة.
   - إعداد ملفات بيئة `.env.example` تتضمن مفاتيح مستقبلية (SUPABASE_URL, SUPABASE_ANON_KEY, STORAGE_BUCKET) بدون قيم حقيقية.
2. **محول مزود البيانات**
   - في `src/lib/data-providers/index.ts`، تعريف واجهة `DataProvider` وتصدير المزود المحلي كخيار افتراضي، مع مفاتيح تبديل مستقبلية (flag عبر env أو إعدادات).
   - إضافة اختبارات للتأكد من أن تغيير المزود لا يغير واجهة الاستدعاء في المكونات.
3. **نقاط تكامل مستقبلية**
   - وضع تعليقات TODO واضحة في صفحات/مكونات الإدخال (`/admin/products`, `/admin/settings`) تشير إلى موضع استدعاء API الحقيقي لاحقاً.
   - تحديد خريطة أحداث (Analytics/Logs) في `src/utils/telemetry.ts` (وهمي) لالتقاط الأحداث محلياً الآن والانتقال لخدمة حقيقية لاحقاً.

## 7) المرحلة 4: تحسينات الأداء والتسليم
1. **بناء وتحزيم**
   - ضبط `next.config.js` لاستخدام `images.unoptimized` أثناء التطوير المحلي والتبديل إلى الوضع المحسَّن عند تفعيل CDN مستقبلاً.
   - تفعيل تحليل الحزم (`next build --analyze`) مرة واحدة للتأكد من عدم تضخم الحزمة بعد إعادة الهيكلة.
2. **تحسين SEO وتجربة الوصول**
   - إضافة بيانات منظمة (JSON-LD) للمنتجات في صفحات التفاصيل.
   - فحص الوصول (aria labels، تباين الألوان) عبر `npm run lint` مع إضافات `eslint-plugin-jsx-a11y` إن لم تكن مفعلة.

## 8) مسار زمني مقترح (بدون خدمات خارجية)
- **الأسبوع 1**: المرحلة 0 (تنظيم الأنواع، مزود البيانات المحلي، تنظيف المكونات).
- **الأسبوع 2**: المرحلة 1 (تجربة المتجر + أداء + skeleton).
- **الأسبوع 3**: المرحلة 2 (حراسة لوحة التحكم، CRUD محلي، اختبارات).
- **الأسبوع 4**: المرحلة 3 + 4 (إعدادات جاهزية الربط، تحسينات الأداء، تحليلات واختبارات نهائية).

## 9) قائمة تحقق سريعة قبل الانتقال لباك-إند
- [ ] المكونات لا تقرأ JSON مباشرة بل عبر `DataProvider`.
- [ ] الأنواع موحدة وتحتوي الحقول المستقبلية (status, remoteImageUrl, stockQuantity).
- [ ] حماية `/admin` عبر Middleware محلي + Hook موحد.
- [ ] اختبارات وحدات للمزود والفلاتر + اختبارات واجهة لأهم المكونات.
- [ ] ملفات `.env.example` جاهزة ومراجعة نقاط TODO للتكامل.
- [ ] صور المنتجات مضبوطة بأحجام ثابتة في البطاقات لتقليل CLS.
- [ ] ESLint/Prettier مفعّلان ويمران بدون أخطاء.

## 10) ملاحظات ختامية
- يمكن لاحقاً استبدال `localProvider` بـ Supabase/Firestore عبر حقن المزود فقط دون تغيير المكونات.
- يفضّل إبقاء بيانات الاختبار قريبة من الواقع (أسعار، مخزون) لتقليل المفاجآت عند ربط الباك-إند.
- التركيز الآن على جودة الواجهة وتجربة التحرير في لوحة التحكم سيقلل 70% من مجهود الانتقال لاحقاً.
